// Core logic
async function loadPosts() { const res = await fetch('/posts/posts.json'); return await res.json(); } // Shuffling util function shuffle(arr) { return arr.sort(() => Math.random() - 0.5); } // Homepage if (document.querySelector("#latest-container")) { loadPosts().then(posts => { // Sort by date desc posts.sort((a,b)=> new Date(b.date) - new Date(a.date)); // Featured post const featured = posts[0]; document.querySelector("#featured-post").innerHTML = ` <article> <h2><a href="/post.html?slug=${featured.slug}">${featured.title}</a></h2> <p>${featured.excerpt}</p> </article> `; // Latest const latestContainer = document.querySelector("#latest-container"); posts.slice(0,5).forEach(p=>{ latestContainer.innerHTML += `<a href="/post.html?slug=${p.slug}">${p.title}</a><br>`; }); // Random const randomContainer = document.querySelector("#random-container"); shuffle([...posts]).slice(0,3).forEach(p=>{ randomContainer.innerHTML += `<a href="/post.html?slug=${p.slug}">${p.title}</a><br>`; }); }); } // Single Post if (document.querySelector("#post-container")) { const slug = new URLSearchParams(window.location.search).get('slug'); loadPosts().then(posts=>{ const post = posts.find(p=>p.slug === slug); if (!post) return; fetch(post.contentFile).then(r=>r.text()).then(html=>{ document.querySelector("#post-container").innerHTML = html; }); // SEO meta updates document.title = `${post.title} | IA World Blog`; document.querySelector("#dynamic-description").content = post.excerpt; document.querySelector("#og-title").content = post.title; document.querySelector("#og-description").content = post.excerpt; document.querySelector("#og-url").content = window.location.href; // Related const related = posts.filter(p=>p.category_slug===post.category_slug && p.slug!==slug).slice(0,3); related.forEach(r=>{ document.querySelector("#related-container").innerHTML += `<a href="/post.html?slug=${r.slug}">${r.title}</a><br>`; }); }); } // Category if (document.querySelector("#category-container")) { const folder = window.location.pathname.split("/").pop().replace(".html",""); loadPosts().then(posts=>{ const filtered = posts.filter(p=>p.category_slug===folder); document.querySelector("#category-name").innerText = folder.toUpperCase(); filtered.forEach(p=>{ document.querySelector("#category-container").innerHTML += `<a href="/post.html?slug=${p.slug}">${p.title}</a><br>`; }); }); } // Search if (document.querySelector("#search")) { document.querySelector("#search").addEventListener("input", e=>{ let term = e.target.value.toLowerCase(); loadPosts().then(posts=>{ const results = posts.filter(p=>p.title.toLowerCase().includes(term) || p.category.toLowerCase().includes(term)); const latestContainer = document.querySelector("#latest-container"); latestContainer.innerHTML = ""; results.forEach(p=>{ latestContainer.innerHTML += `<a href="/post.html?slug=${p.slug}">${p.title}</a><br>`; }); }); }); } // Theme Toggle document.querySelector("#theme-toggle")?.addEventListener("click", ()=>{ document.body.dataset.theme = document.body.dataset.theme === "dark" ? "" : "dark"; });